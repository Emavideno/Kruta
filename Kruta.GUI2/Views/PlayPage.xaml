<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Kruta.GUI2.ViewModels"
             x:Class="Kruta.GUI2.Views.PlayPage"
             BackgroundColor="#1B3F2F"
             Title="Игровое поле">

    <ContentPage.Resources>
        <Style x:Key="OpponentCardBase" TargetType="Rectangle">
            <Setter Property="WidthRequest" Value="55" />
            <Setter Property="HeightRequest" Value="85" />
            <Setter Property="RadiusX" Value="5" />
            <Setter Property="RadiusY" Value="5" />
            <Setter Property="StrokeThickness" Value="2" />
            <Setter Property="Fill" Value="#8B0000" />
            <Setter Property="Stroke" Value="#550000" />
            <Setter Property="Opacity" Value="0.6" />
        </Style>

        <Style x:Key="MyCardStyle" TargetType="Frame">
            <Setter Property="WidthRequest" Value="75" />
            <Setter Property="HeightRequest" Value="115" />
            <Setter Property="BackgroundColor" Value="White" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="HasShadow" Value="True" />
            <Setter Property="BorderColor" Value="Gray" />
        </Style>

        <DataTemplate x:Key="CardTemplate">
            <Frame Style="{StaticResource MyCardStyle}" BorderColor="Gold" BackgroundColor="#F0F0F0">
                <Grid RowDefinitions="Auto, *, Auto">
                    <Label Text="{Binding Cost, StringFormat='Cost: {0}'}" 
                   TextColor="DarkGoldenrod" FontAttributes="Bold" FontSize="10" Margin="2,0"/>

                    <VerticalStackLayout Grid.Row="1" VerticalOptions="Center" HorizontalOptions="Center">
                        <Label Text="{Binding Name}" TextColor="Black" 
                       HorizontalTextAlignment="Center" FontSize="11" FontAttributes="Bold" />
                        <Label Text="{Binding CardId, StringFormat='ID: {0}'}" 
                       TextColor="Gray" FontSize="9" HorizontalOptions="Center" />
                    </VerticalStackLayout>

                    <Label Grid.Row="2" Text="{Binding Initiative}" TextColor="Blue" 
                   HorizontalOptions="End" FontSize="10" Margin="2"/>
                </Grid>
            </Frame>
        </DataTemplate>
    </ContentPage.Resources>

    <Grid RowDefinitions="160, *, 180" 
          ColumnDefinitions="140, *, 140" 
          Padding="15">

        <VerticalStackLayout Grid.Row="1" Grid.Column="1" VerticalOptions="Center" HorizontalOptions="Center" Spacing="10">
            <Label Text="KRUTA" FontSize="48" FontAttributes="Bold" TextColor="White" Opacity="0.1" HorizontalOptions="Center" />

            <Label Text="БАРАХОЛКА" HorizontalOptions="Center" TextColor="Yellow" FontAttributes="Bold" />

            <Grid ColumnDefinitions="100, *" HorizontalOptions="Center" WidthRequest="620">

                <VerticalStackLayout Grid.Column="0" VerticalOptions="Center" Spacing="5" HorizontalOptions="Center">
                    <Frame BackgroundColor="#2C3E50" 
               BorderColor="Goldenrod"
               CornerRadius="5"
               WidthRequest="70" 
               HeightRequest="100"
               Padding="0"
               HasShadow="True">
                        <Label Text="DECK" 
                   TextColor="White" 
                   HorizontalOptions="Center" 
                   VerticalOptions="Center" 
                   FontAttributes="Bold"
                   Rotation="-45"/>
                    </Frame>
                    <Label Text="{Binding DeckRemainingCount, StringFormat='Карт: {0}'}" 
               TextColor="Yellow" 
               HorizontalOptions="Center"
               FontAttributes="Bold"
               FontSize="13"/>
                </VerticalStackLayout>

                <CollectionView Grid.Column="1"
                    ItemsSource="{Binding BaraholkaCards}" 
                    ItemTemplate="{StaticResource CardTemplate}"
                    HeightRequest="150" 
                    WidthRequest="500"
                    BackgroundColor="#0DFFFFFF">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Horizontal" ItemSpacing="10" />
                    </CollectionView.ItemsLayout>
                    <CollectionView.EmptyView>
                        <Label Text="Барахолка пуста..." HorizontalOptions="Center" VerticalOptions="Center" TextColor="Gray"/>
                    </CollectionView.EmptyView>
                </CollectionView>
            </Grid>

            <Label Text="{Binding GameStatus}" FontSize="16" TextColor="AntiqueWhite" HorizontalOptions="Center" />
        </VerticalStackLayout>

        <VerticalStackLayout Grid.Row="0" Grid.Column="1" HorizontalOptions="Center" VerticalOptions="Start" Spacing="5"
                             BindingContext="{Binding Opponents[0]}">
            <Label Text="{Binding Name}" TextColor="White" HorizontalOptions="Center" FontSize="12" />
            <HorizontalStackLayout Spacing="-35" HorizontalOptions="Center">
                <Rectangle Style="{StaticResource OpponentCardBase}">
                    <Rectangle.Triggers>
                        <DataTrigger TargetType="Rectangle" Binding="{Binding IsConnected}" Value="True">
                            <Setter Property="Fill" Value="White"/>
                            <Setter Property="Stroke" Value="LightGray"/>
                            <Setter Property="Opacity" Value="1"/>
                        </DataTrigger>
                    </Rectangle.Triggers>
                </Rectangle>
                <Rectangle Style="{StaticResource OpponentCardBase}">
                    <Rectangle.Triggers>
                        <DataTrigger TargetType="Rectangle" Binding="{Binding IsConnected}" Value="True">
                            <Setter Property="Fill" Value="White"/>
                            <Setter Property="Stroke" Value="LightGray"/>
                            <Setter Property="Opacity" Value="1"/>
                        </DataTrigger>
                    </Rectangle.Triggers>
                </Rectangle>
                <Rectangle Style="{StaticResource OpponentCardBase}">
                    <Rectangle.Triggers>
                        <DataTrigger TargetType="Rectangle" Binding="{Binding IsConnected}" Value="True">
                            <Setter Property="Fill" Value="White"/>
                            <Setter Property="Stroke" Value="LightGray"/>
                            <Setter Property="Opacity" Value="1"/>
                        </DataTrigger>
                    </Rectangle.Triggers>
                </Rectangle>
                <Rectangle Style="{StaticResource OpponentCardBase}">
                    <Rectangle.Triggers>
                        <DataTrigger TargetType="Rectangle" Binding="{Binding IsConnected}" Value="True">
                            <Setter Property="Fill" Value="White"/>
                            <Setter Property="Stroke" Value="LightGray"/>
                            <Setter Property="Opacity" Value="1"/>
                        </DataTrigger>
                    </Rectangle.Triggers>
                </Rectangle>
                <Rectangle Style="{StaticResource OpponentCardBase}">
                    <Rectangle.Triggers>
                        <DataTrigger TargetType="Rectangle" Binding="{Binding IsConnected}" Value="True">
                            <Setter Property="Fill" Value="White"/>
                            <Setter Property="Stroke" Value="LightGray"/>
                            <Setter Property="Opacity" Value="1"/>
                        </DataTrigger>
                    </Rectangle.Triggers>
                </Rectangle>
            </HorizontalStackLayout>
        </VerticalStackLayout>

        <VerticalStackLayout Grid.Row="1" Grid.Column="0" HorizontalOptions="Start" VerticalOptions="Center" Spacing="5" 
                             Rotation="90" BindingContext="{Binding Opponents[1]}">
            <Label Text="{Binding Name}" TextColor="White" HorizontalOptions="Center" FontSize="12"/>
            <HorizontalStackLayout Spacing="-35" HorizontalOptions="Center">
                <Rectangle Style="{StaticResource OpponentCardBase}">
                    <Rectangle.Triggers>
                        <DataTrigger TargetType="Rectangle" Binding="{Binding IsConnected}" Value="True">
                            <Setter Property="Fill" Value="White"/>
                            <Setter Property="Stroke" Value="LightGray"/>
                            <Setter Property="Opacity" Value="1"/>
                        </DataTrigger>
                    </Rectangle.Triggers>
                </Rectangle>
                <Rectangle Style="{StaticResource OpponentCardBase}">
                    <Rectangle.Triggers>
                        <DataTrigger TargetType="Rectangle" Binding="{Binding IsConnected}" Value="True">
                            <Setter Property="Fill" Value="White"/>
                            <Setter Property="Stroke" Value="LightGray"/>
                            <Setter Property="Opacity" Value="1"/>
                        </DataTrigger>
                    </Rectangle.Triggers>
                </Rectangle>
                <Rectangle Style="{StaticResource OpponentCardBase}">
                    <Rectangle.Triggers>
                        <DataTrigger TargetType="Rectangle" Binding="{Binding IsConnected}" Value="True">
                            <Setter Property="Fill" Value="White"/>
                            <Setter Property="Stroke" Value="LightGray"/>
                            <Setter Property="Opacity" Value="1"/>
                        </DataTrigger>
                    </Rectangle.Triggers>
                </Rectangle>
                <Rectangle Style="{StaticResource OpponentCardBase}">
                    <Rectangle.Triggers>
                        <DataTrigger TargetType="Rectangle" Binding="{Binding IsConnected}" Value="True">
                            <Setter Property="Fill" Value="White"/>
                            <Setter Property="Stroke" Value="LightGray"/>
                            <Setter Property="Opacity" Value="1"/>
                        </DataTrigger>
                    </Rectangle.Triggers>
                </Rectangle>
                <Rectangle Style="{StaticResource OpponentCardBase}">
                    <Rectangle.Triggers>
                        <DataTrigger TargetType="Rectangle" Binding="{Binding IsConnected}" Value="True">
                            <Setter Property="Fill" Value="White"/>
                            <Setter Property="Stroke" Value="LightGray"/>
                            <Setter Property="Opacity" Value="1"/>
                        </DataTrigger>
                    </Rectangle.Triggers>
                </Rectangle>
            </HorizontalStackLayout>
        </VerticalStackLayout>

        <VerticalStackLayout Grid.Row="1" Grid.Column="2" HorizontalOptions="End" VerticalOptions="Center" Spacing="5" 
                             Rotation="-90" BindingContext="{Binding Opponents[2]}">
            <Label Text="{Binding Name}" TextColor="White" HorizontalOptions="Center" FontSize="12" />
            <HorizontalStackLayout Spacing="-35" HorizontalOptions="Center">
                <Rectangle Style="{StaticResource OpponentCardBase}">
                    <Rectangle.Triggers>
                        <DataTrigger TargetType="Rectangle" Binding="{Binding IsConnected}" Value="True">
                            <Setter Property="Fill" Value="White"/>
                            <Setter Property="Stroke" Value="LightGray"/>
                            <Setter Property="Opacity" Value="1"/>
                        </DataTrigger>
                    </Rectangle.Triggers>
                </Rectangle>
                <Rectangle Style="{StaticResource OpponentCardBase}">
                    <Rectangle.Triggers>
                        <DataTrigger TargetType="Rectangle" Binding="{Binding IsConnected}" Value="True">
                            <Setter Property="Fill" Value="White"/>
                            <Setter Property="Stroke" Value="LightGray"/>
                            <Setter Property="Opacity" Value="1"/>
                        </DataTrigger>
                    </Rectangle.Triggers>
                </Rectangle>
                <Rectangle Style="{StaticResource OpponentCardBase}">
                    <Rectangle.Triggers>
                        <DataTrigger TargetType="Rectangle" Binding="{Binding IsConnected}" Value="True">
                            <Setter Property="Fill" Value="White"/>
                            <Setter Property="Stroke" Value="LightGray"/>
                            <Setter Property="Opacity" Value="1"/>
                        </DataTrigger>
                    </Rectangle.Triggers>
                </Rectangle>
                <Rectangle Style="{StaticResource OpponentCardBase}">
                    <Rectangle.Triggers>
                        <DataTrigger TargetType="Rectangle" Binding="{Binding IsConnected}" Value="True">
                            <Setter Property="Fill" Value="White"/>
                            <Setter Property="Stroke" Value="LightGray"/>
                            <Setter Property="Opacity" Value="1"/>
                        </DataTrigger>
                    </Rectangle.Triggers>
                </Rectangle>
                <Rectangle Style="{StaticResource OpponentCardBase}">
                    <Rectangle.Triggers>
                        <DataTrigger TargetType="Rectangle" Binding="{Binding IsConnected}" Value="True">
                            <Setter Property="Fill" Value="White"/>
                            <Setter Property="Stroke" Value="LightGray"/>
                            <Setter Property="Opacity" Value="1"/>
                        </DataTrigger>
                    </Rectangle.Triggers>
                </Rectangle>
            </HorizontalStackLayout>
        </VerticalStackLayout>

        <VerticalStackLayout Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" VerticalOptions="End" Spacing="10">
            <Label Text="ВАШИ КАРТЫ" HorizontalOptions="Center" TextColor="White" />
            <CollectionView ItemsSource="{Binding MyHandCards}" 
                ItemTemplate="{StaticResource CardTemplate}"
                HeightRequest="160"
                BackgroundColor="#0DFFFFFF">
                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Horizontal" ItemSpacing="5" />
                </CollectionView.ItemsLayout>
            </CollectionView>
        </VerticalStackLayout>
        
        

    </Grid>
</ContentPage>